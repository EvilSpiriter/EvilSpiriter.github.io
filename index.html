<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能热榜解析系统 - 云端同步版</title>
    <style>
        :root {
            --primary: #1a6dff;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, var(--primary), #0d5bdd);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 24px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }
        
        /* 左侧输入面板 */
        .input-panel {
            padding: 30px;
            background: #f8f9ff;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-area {
            flex: 1;
            margin-bottom: 20px;
        }
        
        textarea {
            width: 100%;
            height: 100%;
            min-height: 400px;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            border-style: solid;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: #333; }
        .btn-info { background: var(--info); color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 109, 255, 0.2);
        }
        
        /* 右侧输出面板 */
        .output-panel {
            padding: 30px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .preview-area {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 20px;
            background: white;
        }
        
        /* 热帖预览样式 */
        .post-preview {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9ff;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            position: relative;
        }
        
        .post-preview:hover {
            background: #e7f3ff;
            transform: translateX(5px);
        }
        
        .post-rank {
            display: inline-block;
            width: 28px;
            height: 28px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .post-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            cursor: pointer;
            display: inline-block;
        }
        
        .post-title:hover {
            color: var(--primary);
        }
        
        .post-link {
            font-size: 12px;
            color: #666;
            margin-left: 5px;
            text-decoration: none;
        }
        
        .post-link:hover {
            color: var(--primary);
            text-decoration: underline;
        }
        
        .post-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }
        
        /* 管理员面板 */
        .admin-panel {
            background: #fff8e1;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .admin-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* 消息提示 */
        .message {
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            display: none;
        }
        
        .message-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* 响应式 */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .input-panel {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
        }
        
        /* 解析状态 */
        .parse-status {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
        }
        
        .parse-success {
            background: #e7f3ff;
            color: var(--primary);
            border: 1px solid #b3d7ff;
        }
        
        .parse-error {
            background: #fde8e8;
            color: var(--danger);
            border: 1px solid #f8b4b4;
        }
        
        /* 登录保护 */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .login-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f0f2f5;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        /* 公共热榜页面 */
        .public-view {
            padding: 30px;
        }
        
        .public-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .public-header h2 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .public-header .update-time {
            color: #666;
            font-size: 14px;
        }
        
        /* 热榜项样式 */
        .hotlist-item {
            display: flex;
            align-items: center;
            padding: 20px;
            margin-bottom: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .hotlist-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .item-rank {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .rank-1 { background: linear-gradient(135deg, #ffd700, #ffa500); color: white; }
        .rank-2 { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); color: white; }
        .rank-3 { background: linear-gradient(135deg, #cd7f32, #a66929); color: white; }
        .rank-other { background: #f0f2f5; color: #606266; }
        
        .item-content {
            flex: 1;
        }
        
        .item-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            line-height: 1.4;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .item-link {
            font-size: 12px;
            color: #666;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }
        
        .item-link:hover {
            color: var(--primary);
            text-decoration: underline;
        }
        
        .item-meta {
            display: flex;
            gap: 20px;
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .item-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #888;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 模式切换 */
        .mode-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .mode-btn {
            background: white;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
        }
        
        /* 帖子详情页样式 */
        .post-detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .post-detail {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }
        
        .detail-header {
            padding: 30px 30px 20px;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        
        .detail-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f0f2f5;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .detail-close:hover {
            background: #e4e6eb;
        }
        
        .detail-body {
            padding: 30px;
        }
        
        .detail-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }
        
        .detail-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .detail-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9ff;
            min-width: 100px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .detail-link {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .detail-link:hover {
            background: #0d5bdd;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 109, 255, 0.3);
        }
        
        .link-unavailable {
            display: none;
        }
        
        /* 链接图标 */
        .link-icon {
            font-size: 12px;
            opacity: 0.6;
        }
        
        /* 同步状态样式 */
        .sync-status {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px auto;
            font-size: 14px;
            max-width: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            display: none;
        }
        
        .sync-loading {
            background: #e7f3ff;
            color: var(--primary);
            border: 1px solid #b3d7ff;
        }
        
        .sync-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .sync-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .sync-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        /* 配置指南弹窗 */
        .config-guide-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .config-guide {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }
        
        .guide-header {
            padding: 25px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(90deg, var(--primary), #0d5bdd);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        
        .guide-body {
            padding: 30px;
        }
        
        .guide-step {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .config-input-group {
            margin: 20px 0;
        }
        
        .config-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 8px;
        }
        
        .config-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .guide-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            text-align: center;
        }
        
        /* 更新提示 */
        .update-tip {
            background: #e7f3ff;
            border: 1px solid #b3d7ff;
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 13px;
            color: var(--primary);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- 管理员登录层 -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <button class="login-close" onclick="closeLoginOverlay()">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="login-title"><i class="fas fa-lock"></i> 管理员登录</h2>
            <div class="form-group">
                <label class="form-label">账号</label>
                <input type="text" class="form-control" id="adminAccount" placeholder="请输入管理员账号">
            </div>
            <div class="form-group">
                <label class="form-label">密码</label>
                <input type="password" class="form-control" id="adminPassword" placeholder="请输入密码">
            </div>
            <button class="btn btn-primary" style="width:100%;" onclick="checkLogin()">
                <i class="fas fa-sign-in-alt"></i> 登录
            </button>
            <p style="text-align:center; margin-top:15px; color:#666; font-size:12px;">
                普通用户无需登录，直接查看热榜
            </p>
        </div>
    </div>

    <!-- JSONBin配置指南 -->
    <div class="config-guide-overlay" id="configGuideOverlay">
        <div class="config-guide">
            <div class="guide-header">
                <h2><i class="fas fa-cloud"></i> 云端同步配置指南</h2>
                <p>只需3步，开启云端同步功能</p>
            </div>
            <div class="guide-body">
                <div class="guide-step">
                    <h3><span class="step-number">1</span> 注册 JSONBin.io 账号</h3>
                    <p>访问 <a href="https://jsonbin.io" target="_blank" style="color: var(--primary); font-weight: bold;">https://jsonbin.io</a> 注册免费账号</p>
                    <p>点击右上角 "Sign Up" 按钮，使用邮箱注册即可</p>
                    <button class="btn btn-primary" onclick="openJsonbin()">
                        <i class="fas fa-external-link-alt"></i> 前往 JSONBin.io
                    </button>
                </div>
                
                <div class="guide-step">
                    <h3><span class="step-number">2</span> 创建数据存储桶</h3>
                    <p>登录后点击 "Create New Bin"</p>
                    <p>在编辑框中输入：<code style="background: #f0f2f5; padding: 5px 10px; border-radius: 4px;">{"posts": []}</code></p>
                    <p>点击 "Save" 保存</p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <p><strong>重要：</strong>保存后，您会看到类似这样的信息：</p>
                        <pre style="background: #333; color: #fff; padding: 10px; border-radius: 5px; overflow-x: auto;">
Bin ID: 65b3b1b7266cfc3fde8c9b3a
Master Key: $2a$10$Xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</pre>
                    </div>
                </div>
                
                <div class="guide-step">
                    <h3><span class="step-number">3</span> 配置系统</h3>
                    <p>将上一步获取的信息填入下方：</p>
                    
                    <div class="config-input-group">
                        <label><strong>Bin ID：</strong></label>
                        <input type="text" class="config-input" id="configBinId" placeholder="例如：65b3b1b7266cfc3fde8c9b3a">
                    </div>
                    
                    <div class="config-input-group">
                        <label><strong>Master Key（可选）：</strong></label>
                        <input type="password" class="config-input" id="configMasterKey" placeholder="如果您想保护数据，请填写">
                        <p style="font-size: 12px; color: #666; margin-top: 5px;">不填写 Master Key 时，任何人都可以修改您的数据</p>
                    </div>
                    
                    <div class="config-input-group">
                        <label><strong>数据同步密码：</strong></label>
                        <input type="password" class="config-input" id="configSyncPassword" placeholder="设置一个访问密码（可选）">
                        <p style="font-size: 12px; color: #666; margin-top: 5px;">其他用户需要输入此密码才能从云端获取数据</p>
                    </div>
                </div>
            </div>
            <div class="guide-footer">
                <button class="btn btn-success" onclick="saveCloudConfig()" style="padding: 12px 30px;">
                    <i class="fas fa-check"></i> 保存配置
                </button>
                <button class="btn" onclick="closeConfigGuide()" style="margin-left: 10px; background: #6c757d; color: white;">
                    跳过配置
                </button>
            </div>
        </div>
    </div>

    <!-- 密码输入弹窗 -->
    <div class="login-overlay" id="passwordOverlay">
        <div class="login-box">
            <h2 class="login-title"><i class="fas fa-key"></i> 输入同步密码</h2>
            <div class="form-group">
                <label class="form-label">请输入数据同步密码</label>
                <input type="password" class="form-control" id="syncPassword" placeholder="请输入密码">
                <p style="font-size: 12px; color: #666; margin-top: 5px;">管理员设置的云端数据访问密码</p>
            </div>
            <button class="btn btn-primary" style="width:100%;" onclick="checkSyncPassword()">
                <i class="fas fa-unlock"></i> 确认
            </button>
            <button class="btn" onclick="closePasswordOverlay()" style="width:100%; margin-top:10px; background: #6c757d; color: white;">
                取消
            </button>
        </div>
    </div>

    <!-- 管理员编辑界面 -->
    <div class="container" id="adminContainer" style="display:none;">
        <div class="header">
            <h1>
                <span class="header-icon"><i class="fas fa-robot"></i></span>
                AI热榜数据解析系统
                <span style="font-size: 14px; background: #4cd964; color: white; padding: 4px 10px; border-radius: 20px; margin-left: 10px;">
                    <i class="fas fa-cloud"></i> 云端同步版
                </span>
            </h1>
            <p>将AI回复粘贴到左侧，自动解析生成热榜</p>
            <div style="margin-top:15px;">
                <button class="btn btn-warning" onclick="showPublicView()">
                    <i class="fas fa-eye"></i> 查看热榜
                </button>
                <button class="btn btn-info" onclick="showConfigGuide()" style="margin-left:10px;">
                    <i class="fas fa-cog"></i> 云端配置
                </button>
                <button class="btn" onclick="logout()" style="background:#666; color:white; margin-left:10px;">
                    <i class="fas fa-sign-out-alt"></i> 退出
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- 左侧：数据输入 -->
            <div class="input-panel">
                <div class="panel-title">
                    <i class="fas fa-paste"></i> 粘贴AI回复
                </div>
                
                <div class="input-area">
                    <textarea id="aiInput" placeholder="请将AI回复的内容粘贴到这里...

支持格式示例（推荐包含链接）：
1. 今日技术分享：JavaScript新特性 [程序员小明] 2560浏览 320点赞 45评论 2小时前 链接：https://example.com/post/1
2. 前端框架对比讨论 [技术达人] 1890浏览 210点赞 32评论 3小时前 链接：https://example.com/post/2

或JSON格式（包含link字段）：
{
  'posts': [
    {
      'title': '帖子标题',
      'author': '作者名',
      'views': 1000,
      'likes': 100,
      'comments': 50,
      'time': '2小时前',
      'link': 'https://example.com/post/1'
    }
  ]
}

系统会自动提取链接，无效链接将不显示！"></textarea>
                </div>
                
                <div class="parse-status" id="parseStatus"></div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="parseAIResponse()">
                        <i class="fas fa-magic"></i> 智能解析
                    </button>
                    <button class="btn btn-warning" onclick="testWithSampleData()">
                        <i class="fas fa-vial"></i> 测试解析
                    </button>
                    <button class="btn" onclick="clearInput()" style="background:#6c757d; color:white;">
                        <i class="fas fa-trash"></i> 清空
                    </button>
                    <button class="btn btn-success" onclick="saveToPublic()" id="saveBtn" disabled>
                        <i class="fas fa-cloud-upload-alt"></i> 发布到云端
                    </button>
                </div>
                
                <!-- 管理员配置 -->
                <div class="admin-panel">
                    <div class="admin-title">
                        <i class="fas fa-user-shield"></i> 管理员设置
                    </div>
                    <div class="form-group">
                        <label class="form-label">热榜标题</label>
                        <input type="text" class="form-control" id="hotlistTitle" value="今日频道热帖排行榜" placeholder="请输入热榜标题">
                    </div>
                    <div class="form-group">
                        <label class="form-label">更新说明</label>
                        <input type="text" class="form-control" id="updateNote" value="数据来源于频道AI分析" placeholder="更新说明">
                    </div>
                    <div class="form-group">
                        <label class="form-label">显示数量</label>
                        <select class="form-control" id="displayCount">
                            <option value="5">前5名</option>
                            <option value="10" selected>前10名</option>
                            <option value="15">前15名</option>
                            <option value="20">前20名</option>
                        </select>
                    </div>
                    
                    <!-- 云端状态显示 -->
                    <div id="cloudStatus" style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 6px; font-size: 12px;">
                        <div><i class="fas fa-cloud"></i> <strong>云端状态：</strong><span id="cloudStatusText">未配置</span></div>
                        <div style="margin-top: 5px;"><i class="fas fa-sync-alt"></i> <strong>最后同步：</strong><span id="lastSyncTime">从未同步</span></div>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：数据预览 -->
            <div class="output-panel">
                <div class="panel-title">
                    <i class="fas fa-eye"></i> 解析预览
                    <span id="parsedCount" style="font-size:12px; color:#666; margin-left:10px;">0条数据</span>
                </div>
                
                <div class="preview-area" id="previewArea">
                    <div style="text-align:center; padding:50px 20px; color:#999;">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p style="margin-top:15px;">等待解析数据...</p>
                    </div>
                </div>
                
                <div class="message" id="saveMessage"></div>
            </div>
        </div>
    </div>
    
    <!-- 公共热榜页面 -->
    <div class="container" id="publicContainer">
        <div class="public-view">
            <div class="public-header">
                <h2 id="publicTitle">今日频道热帖排行榜</h2>
                <div class="update-time" id="updateTime">最后更新：从未更新</div>
                <div id="cloudInfo" style="font-size: 12px; color: #666; margin-top: 5px;">
                    <i class="fas fa-cloud"></i> <span id="cloudSourceInfo">使用本地数据</span>
                </div>
            </div>
            
            <!-- 同步状态显示 -->
            <div id="syncStatus"></div>
            
            <div id="publicHotlist">
                <!-- 热榜内容动态生成 -->
            </div>
            
            <div style="text-align:center; margin-top:40px; padding-top:20px; border-top:1px solid #eee;">
                <button class="btn btn-primary" onclick="showLoginOverlay()">
                    <i class="fas fa-edit"></i> 管理员登录
                </button>
                <button class="btn btn-success" onclick="refreshData()" style="margin-left:10px;">
                    <i class="fas fa-sync-alt"></i> 更新数据
                </button>
                <button class="btn btn-info" onclick="showConfigGuide()" style="margin-left:10px;">
                    <i class="fas fa-cog"></i> 云端配置
                </button>
                <p style="color:#666; margin-top:15px; font-size:13px;">
                    支持云端同步 • 数据保存在云端服务器 • 实时更新
                </p>
                <p id="autoUpdateInfo" style="font-size:12px; color:#999; margin-top:5px; display:none;">
                    <i class="fas fa-clock"></i> 自动更新已开启（每5分钟检查一次）
                </p>
            </div>
        </div>
    </div>

    <!-- 帖子详情页 -->
    <div class="post-detail-overlay" id="postDetailOverlay">
        <div class="post-detail">
            <div class="detail-header">
                <button class="detail-close" onclick="closePostDetail()">
                    <i class="fas fa-times"></i>
                </button>
                <h3 id="detailPostTitle">帖子标题</h3>
            </div>
            <div class="detail-body">
                <div class="detail-meta" id="detailPostMeta">
                    <!-- 元数据动态生成 -->
                </div>
                <div class="detail-stats" id="detailPostStats">
                    <!-- 统计数据动态生成 -->
                </div>
                <a href="#" target="_blank" class="detail-link" id="detailPostLink">
                    <i class="fas fa-external-link-alt"></i> 查看原帖
                </a>
            </div>
        </div>
    </div>

    <!-- 模式切换按钮 -->
    <div class="mode-switcher">
        <button class="mode-btn" id="modeSwitchBtn" onclick="switchMode()">
            <i class="fas fa-exchange-alt"></i> 切换模式
        </button>
    </div>

    <script>
        // ============================================
        // 【系统配置】
        // ============================================
        
        // 管理员账号
        const ADMIN_ACCOUNT = "admin";
        const ADMIN_PASSWORD = "123456"; // 建议修改
        
        // 存储键名
        const STORAGE_KEYS = {
            PUBLIC_HOTLIST_DATA: 'ai_public_hotlist_data_v3',
            ADMIN_HOTLIST_DATA: 'ai_admin_hotlist_data_v3',
            LOGIN_TOKEN: 'ai_login_token_v3',
            CLOUD_CONFIG: 'ai_cloud_config_v3'
        };
        
        // JSONBin.io 配置
        const JSONBIN_CONFIG = {
            BASE_URL: 'https://api.jsonbin.io/v3/b',
            EXAMPLE_BIN: '65b3b1b7266cfc3fde8c9b3a' // 公开示例 bin（只读）
        };
        
        // 当前模式
        let currentMode = 'public';
        
        // 解析后的数据缓存
        let parsedPosts = [];
        
        // 云端配置
        let cloudConfig = {
            binId: '',
            masterKey: '',
            syncPassword: '',
            configured: false
        };
        
        // 自动更新定时器
        let autoUpdateTimer = null;
        
        // ============================================
        // 【云端配置管理】
        // ============================================
        
        function loadCloudConfig() {
            try {
                const configStr = localStorage.getItem(STORAGE_KEYS.CLOUD_CONFIG);
                if (configStr) {
                    cloudConfig = JSON.parse(configStr);
                    updateCloudStatusDisplay();
                    
                    // 如果已配置云端，启动自动更新
                    if (cloudConfig.configured) {
                        startAutoUpdate();
                    }
                    
                    return cloudConfig;
                }
            } catch (e) {
                console.error('加载云端配置失败:', e);
            }
            return null;
        }
        
        function saveCloudConfig() {
            const binId = document.getElementById('configBinId').value.trim();
            const masterKey = document.getElementById('configMasterKey').value.trim();
            const syncPassword = document.getElementById('configSyncPassword').value.trim();
            
            if (!binId) {
                showMessage('请输入 Bin ID', 'error');
                return;
            }
            
            cloudConfig = {
                binId: binId,
                masterKey: masterKey,
                syncPassword: syncPassword,
                configured: true,
                configTime: new Date().toISOString()
            };
            
            try {
                localStorage.setItem(STORAGE_KEYS.CLOUD_CONFIG, JSON.stringify(cloudConfig));
                closeConfigGuide();
                updateCloudStatusDisplay();
                showMessage('云端配置保存成功！', 'success');
                
                // 启动自动更新
                startAutoUpdate();
                
                // 如果已经登录，刷新云端状态
                if (currentMode === 'admin') {
                    checkCloudConnection();
                }
            } catch (e) {
                showMessage('保存配置失败: ' + e.message, 'error');
            }
        }
        
        function updateCloudStatusDisplay() {
            const statusEl = document.getElementById('cloudStatusText');
            const syncTimeEl = document.getElementById('lastSyncTime');
            const cloudInfoEl = document.getElementById('cloudSourceInfo');
            
            if (cloudConfig.configured) {
                if (statusEl) statusEl.textContent = '已配置';
                if (cloudInfoEl) cloudInfoEl.textContent = '已启用云端同步';
                
                // 获取最后同步时间
                const publicData = loadPublicData();
                if (publicData && publicData.meta && publicData.meta.lastSyncTime) {
                    const timeStr = new Date(publicData.meta.lastSyncTime).toLocaleString();
                    if (syncTimeEl) syncTimeEl.textContent = timeStr;
                }
            } else {
                if (statusEl) statusEl.textContent = '未配置';
                if (syncTimeEl) syncTimeEl.textContent = '从未同步';
                if (cloudInfoEl) cloudInfoEl.textContent = '使用本地数据';
            }
        }
        
        function showConfigGuide() {
            document.getElementById('configGuideOverlay').style.display = 'flex';
        }
        
        function closeConfigGuide() {
            document.getElementById('configGuideOverlay').style.display = 'none';
        }
        
        function openJsonbin() {
            window.open('https://jsonbin.io', '_blank');
        }
        
        function checkCloudConnection() {
            if (!cloudConfig.configured || !cloudConfig.binId) {
                return Promise.resolve(false);
            }
            
            showSyncStatus('正在测试云端连接...', 'loading');
            
            return fetch(`${JSONBIN_CONFIG.BASE_URL}/${cloudConfig.binId}`, {
                headers: cloudConfig.masterKey ? {
                    'X-Master-Key': cloudConfig.masterKey
                } : {}
            })
            .then(response => {
                if (response.ok) {
                    showSyncStatus('云端连接正常', 'success');
                    return true;
                } else {
                    showSyncStatus('云端连接失败', 'error');
                    return false;
                }
            })
            .catch(error => {
                showSyncStatus('网络连接错误: ' + error.message, 'error');
                return false;
            });
        }
        
        // ============================================
        // 【密码保护功能】
        // ============================================
        
        function showPasswordOverlay() {
            document.getElementById('passwordOverlay').style.display = 'flex';
        }
        
        function closePasswordOverlay() {
            document.getElementById('passwordOverlay').style.display = 'none';
            document.getElementById('syncPassword').value = '';
        }
        
        function checkSyncPassword() {
            const inputPassword = document.getElementById('syncPassword').value;
            const storedPassword = cloudConfig.syncPassword;
            
            if (!storedPassword || inputPassword === storedPassword) {
                closePasswordOverlay();
                refreshData(true);
            } else {
                showMessage('密码错误', 'error');
            }
        }
        
        // ============================================
        // 【数据更新功能 - 核心功能】
        // ============================================
        
        // 刷新数据（主要更新函数）
        function refreshData(force = false) {
            // 检查是否需要密码
            if (cloudConfig.configured && cloudConfig.syncPassword && !force) {
                showPasswordOverlay();
                return;
            }
            
            // 确定使用哪个 bin
            let binId = cloudConfig.configured ? cloudConfig.binId : JSONBIN_CONFIG.EXAMPLE_BIN;
            
            showSyncStatus('正在更新数据...', 'loading');
            
            fetchDataFromCloud(binId)
                .then(result => {
                    if (result.success) {
                        showSyncStatus(`数据更新成功！${result.count} 条数据`, 'success');
                        showMessage('数据已更新到最新版本', 'success');
                    }
                })
                .catch(error => {
                    showSyncStatus('更新失败: ' + error.message, 'error');
                });
        }
        
        // 从云端获取数据的核心函数
        async function fetchDataFromCloud(binId) {
            try {
                const url = `${JSONBIN_CONFIG.BASE_URL}/${binId}/latest`;
                const headers = {};
                
                if (cloudConfig.configured && cloudConfig.masterKey) {
                    headers['X-Master-Key'] = cloudConfig.masterKey;
                }
                
                const response = await fetch(url, { headers });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('Bin ID 不存在或已被删除');
                    } else if (response.status === 403) {
                        throw new Error('访问被拒绝，请检查 Master Key');
                    } else {
                        throw new Error(`HTTP错误: ${response.status}`);
                    }
                }
                
                const result = await response.json();
                
                if (result.record) {
                    // 验证数据格式
                    if (!result.record.posts || !Array.isArray(result.record.posts)) {
                        throw new Error('云端数据格式错误');
                    }
                    
                    // 检查是否有新数据
                    const localData = loadPublicData();
                    const isNewData = !localData || 
                                     !localData.meta || 
                                     !localData.meta.updateTime || 
                                     !result.record.meta || 
                                     !result.record.meta.updateTime ||
                                     new Date(result.record.meta.updateTime) > new Date(localData.meta.updateTime);
                    
                    // 添加同步来源标记
                    result.record.meta = result.record.meta || {};
                    result.record.meta.cloudSource = true;
                    result.record.meta.lastSyncTime = new Date().toISOString();
                    result.record.meta.syncFrom = cloudConfig.configured ? 'user_bin' : 'example_bin';
                    
                    // 保存到本地
                    if (savePublicData(result.record)) {
                        // 更新显示
                        renderPublicHotlist();
                        
                        // 更新云端状态显示
                        updateCloudStatusDisplay();
                        
                        return {
                            success: true,
                            count: result.record.posts.length,
                            isNewData: isNewData,
                            updateTime: result.record.meta.updateTime
                        };
                    }
                } else {
                    throw new Error('云端返回数据格式错误');
                }
            } catch (error) {
                console.error('获取云端数据失败:', error);
                
                // 显示配置指南
                if (!cloudConfig.configured) {
                    setTimeout(() => {
                        if (confirm('云端数据获取失败，是否现在配置您自己的云端存储？')) {
                            showConfigGuide();
                        }
                    }, 1500);
                }
                
                throw error;
            }
        }
        
        // 自动更新功能
        function startAutoUpdate() {
            // 清除现有的定时器
            if (autoUpdateTimer) {
                clearInterval(autoUpdateTimer);
            }
            
            // 每5分钟检查一次更新（300000毫秒）
            autoUpdateTimer = setInterval(() => {
                if (cloudConfig.configured && currentMode === 'public') {
                    checkForUpdates();
                }
            }, 300000); // 5分钟
            
            // 显示自动更新提示
            const autoUpdateInfo = document.getElementById('autoUpdateInfo');
            if (autoUpdateInfo) {
                autoUpdateInfo.style.display = 'block';
            }
            
            console.log('自动更新已启动，每5分钟检查一次');
        }
        
        // 检查是否有更新
        async function checkForUpdates() {
            if (!cloudConfig.configured || !cloudConfig.binId) {
                return;
            }
            
            try {
                const url = `${JSONBIN_CONFIG.BASE_URL}/${cloudConfig.binId}/latest`;
                const headers = {};
                
                if (cloudConfig.masterKey) {
                    headers['X-Master-Key'] = cloudConfig.masterKey;
                }
                
                const response = await fetch(url, { headers });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    if (result.record && result.record.meta && result.record.meta.updateTime) {
                        const localData = loadPublicData();
                        
                        // 检查云端数据是否比本地数据更新
                        if (!localData || !localData.meta || !localData.meta.updateTime || 
                            new Date(result.record.meta.updateTime) > new Date(localData.meta.updateTime)) {
                            
                            // 显示更新提示
                            showUpdateNotification();
                        }
                    }
                }
            } catch (error) {
                console.log('检查更新失败:', error);
            }
        }
        
        // 显示更新通知
        function showUpdateNotification() {
            // 创建更新提示
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position:fixed; top:20px; right:20px; padding:15px 20px; 
                     background:var(--primary); color:white; border-radius:8px; 
                     z-index:9999; max-width:400px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
                     display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-sync-alt"></i>
                    <div>
                        <div style="font-weight:bold;">有新的数据更新</div>
                        <div style="font-size:12px; opacity:0.8;">点击"更新数据"按钮获取最新内容</div>
                    </div>
                    <button onclick="this.parentElement.remove()" style="background:none; border:none; color:white; cursor:pointer; margin-left:10px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // 5秒后自动消失
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // 显示同步状态
        function showSyncStatus(message, type) {
            const statusEl = document.getElementById('syncStatus');
            if (!statusEl) return;
            
            let icon = 'info-circle';
            if (type === 'loading') icon = 'spinner fa-spin';
            else if (type === 'success') icon = 'check-circle';
            else if (type === 'error') icon = 'times-circle';
            else if (type === 'warning') icon = 'exclamation-circle';
            
            statusEl.innerHTML = `
                <div class="sync-status sync-${type}">
                    <i class="fas fa-${icon}"></i>
                    ${message}
                </div>
            `;
            statusEl.style.display = 'block';
            
            if (type !== 'loading') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }
        
        // ============================================
        // 【云端上传功能】
        // ============================================
        
        async function saveToCloud() {
            const publicData = loadPublicData();
            
            if (!publicData || !publicData.posts || publicData.posts.length === 0) {
                showMessage('没有数据可以上传', 'error');
                return;
            }
            
            if (!cloudConfig.configured) {
                if (confirm('您还没有配置云端存储，是否现在配置？')) {
                    showConfigGuide();
                }
                return;
            }
            
            showSyncStatus('正在上传数据到云端...', 'loading');
            
            try {
                const url = `${JSONBIN_CONFIG.BASE_URL}/${cloudConfig.binId}`;
                
                // 更新元数据
                publicData.meta = publicData.meta || {};
                publicData.meta.lastUpdate = new Date().toISOString();
                publicData.meta.updatedBy = 'admin';
                
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (cloudConfig.masterKey) {
                    headers['X-Master-Key'] = cloudConfig.masterKey;
                } else {
                    showSyncStatus('警告：未设置 Master Key，数据可能被公开修改', 'warning');
                }
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: headers,
                    body: JSON.stringify(publicData)
                });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('Bin ID 不存在或已被删除');
                    } else if (response.status === 403) {
                        throw new Error('访问被拒绝，请检查 Master Key');
                    } else {
                        throw new Error(`HTTP错误: ${response.status}`);
                    }
                }
                
                const result = await response.json();
                
                // 更新本地数据的同步时间
                publicData.meta.lastSyncTime = new Date().toISOString();
                savePublicData(publicData);
                
                showSyncStatus('数据已成功上传到云端！', 'success');
                showMessage('云端同步完成，其他人现在可以看到最新数据', 'success');
                
                updateCloudStatusDisplay();
                
            } catch (error) {
                console.error('上传数据失败:', error);
                showSyncStatus('上传失败: ' + error.message, 'error');
                showMessage('上传数据失败: ' + error.message, 'error');
            }
        }
        
        // ============================================
        // 【数据持久化】
        // ============================================
        
        function savePublicData(data) {
            try {
                localStorage.setItem(STORAGE_KEYS.PUBLIC_HOTLIST_DATA, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('保存数据失败:', e);
                showMessage('保存数据失败: ' + e.message, 'error');
                return false;
            }
        }
        
        function loadPublicData() {
            try {
                const dataStr = localStorage.getItem(STORAGE_KEYS.PUBLIC_HOTLIST_DATA);
                if (dataStr) {
                    return JSON.parse(dataStr);
                }
            } catch (e) {
                console.error('加载数据失败:', e);
            }
            return null;
        }
        
        function saveAdminData(data) {
            try {
                localStorage.setItem(STORAGE_KEYS.ADMIN_HOTLIST_DATA, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('保存管理员数据失败:', e);
                return false;
            }
        }
        
        // ============================================
        // 【登录验证】
        // ============================================
        
        function showLoginOverlay() {
            document.getElementById('loginOverlay').style.display = 'flex';
        }
        
        function closeLoginOverlay() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('adminAccount').value = '';
            document.getElementById('adminPassword').value = '';
        }
        
        function checkLogin() {
            const account = document.getElementById('adminAccount').value;
            const password = document.getElementById('adminPassword').value;
            
            if (account === ADMIN_ACCOUNT && password === ADMIN_PASSWORD) {
                const token = {
                    account: account,
                    loginTime: new Date().toISOString(),
                    expires: Date.now() + 24 * 60 * 60 * 1000
                };
                
                localStorage.setItem(STORAGE_KEYS.LOGIN_TOKEN, JSON.stringify(token));
                
                closeLoginOverlay();
                showAdminView();
                showMessage('登录成功！', 'success');
            } else {
                showMessage('账号或密码错误', 'error');
            }
        }
        
        function checkAutoLogin() {
            const tokenStr = localStorage.getItem(STORAGE_KEYS.LOGIN_TOKEN);
            
            if (tokenStr) {
                try {
                    const token = JSON.parse(tokenStr);
                    if (token.expires > Date.now()) {
                        return true;
                    } else {
                        localStorage.removeItem(STORAGE_KEYS.LOGIN_TOKEN);
                    }
                } catch (e) {
                    localStorage.removeItem(STORAGE_KEYS.LOGIN_TOKEN);
                }
            }
            return false;
        }
        
        function logout() {
            localStorage.removeItem(STORAGE_KEYS.LOGIN_TOKEN);
            showPublicView();
            showMessage('已退出登录', 'success');
        }
        
        // ============================================
        // 【AI回复解析引擎】
        // ============================================
        
        function parseAIResponse() {
            const input = document.getElementById('aiInput').value.trim();
            
            if (!input) {
                showParseStatus('请输入AI回复内容', 'error');
                return;
            }
            
            parsedPosts = [];
            
            let success = false;
            if (!success) success = tryParseJSON(input);
            if (!success) success = tryParseNumberedList(input);
            if (!success) success = tryParseTableFormat(input);
            if (!success) success = tryParseNaturalLanguage(input);
            if (!success) success = tryParseGeneric(input);
            
            if (success) {
                showParseStatus(`成功解析 ${parsedPosts.length} 条热帖数据`, 'success');
                renderPreview();
                enableSaveButton();
            } else {
                showParseStatus('无法解析数据，请检查格式', 'error');
            }
        }
        
        function tryParseJSON(input) {
            try {
                let cleanedInput = input.trim();
                const jsonMatch = cleanedInput.match(/\{[\s\S]*\}/);
                if (jsonMatch) cleanedInput = jsonMatch[0];
                cleanedInput = cleanedInput.replace(/'/g, '"');
                
                const data = JSON.parse(cleanedInput);
                
                if (data.posts && Array.isArray(data.posts)) {
                    parsedPosts = data.posts.map((post, index) => ({
                        rank: index + 1,
                        title: post.title || post.Title || `帖子 ${index + 1}`,
                        author: post.author || post.Author || post.creator || '未知作者',
                        views: parseInt(post.views || post.Views || post.view_count || 0),
                        likes: parseInt(post.likes || post.Likes || post.like_count || 0),
                        comments: parseInt(post.comments || post.Comments || post.comment_count || 0),
                        time: post.time || post.Time || post.created_at || '最近',
                        link: extractAndValidateLink(post.link || post.Link || post.url || post.URL || '')
                    }));
                    return true;
                }
            } catch (e) {
                console.log('JSON解析失败:', e.message);
            }
            return false;
        }
        
        function tryParseNumberedList(input) {
            const lines = input.split('\n').filter(line => line.trim());
            const posts = [];
            
            lines.forEach(line => {
                line = line.trim();
                
                const patterns = [
                    /^(\d+)[\.、]\s*(.+?)\s+\[(.+?)\]\s+(\d+)\s*浏览\s+(\d+)\s*点赞\s+(\d+)\s*评论\s+(.+?)(?:\s+链接[:：]\s*(https?:\/\/\S+))?$/,
                    /^(\d+)[\.、]\s*(.+?)\s+[-–]\s+(.+?)\s+[-–]\s+(\d+)\s*浏览\s+[-–]\s+(\d+)\s*点赞\s+[-–]\s+(\d+)\s*评论\s+[-–]\s+(.+?)(?:\s+[-–]\s+链接[:：]\s*(https?:\/\/\S+))?$/,
                    /^(\d+)\s+(.+?)\s*\((.+?)\)\s+(\d+)\s*浏览\s+(\d+)\s*点赞\s+(\d+)\s*评论\s+(.+?)(?:\s+链接[:：]\s*(https?:\/\/\S+))?$/,
                    /^(\d+)[\.、]\s*(.+?)(?:\s+链接[:：]\s*(https?:\/\/\S+))?$/
                ];
                
                let match = null;
                for (const pattern of patterns) {
                    match = line.match(pattern);
                    if (match) break;
                }
                
                if (match) {
                    const post = {
                        rank: parseInt(match[1]),
                        title: match[2].trim(),
                        author: '未知作者',
                        views: 0,
                        likes: 0,
                        comments: 0,
                        time: '最近',
                        link: ''
                    };
                    
                    const authorMatch = line.match(/\[(.+?)\]/) || line.match(/\((.+?)\)/);
                    if (authorMatch) post.author = authorMatch[1].trim();
                    
                    const viewMatch = line.match(/(\d+)\s*浏览/);
                    const likeMatch = line.match(/(\d+)\s*点赞/);
                    const commentMatch = line.match(/(\d+)\s*评论/);
                    const timeMatch = line.match(/(\d+\s*(?:分钟|小时|天)前|今天|最近)/);
                    
                    if (viewMatch) post.views = parseInt(viewMatch[1]);
                    if (likeMatch) post.likes = parseInt(likeMatch[1]);
                    if (commentMatch) post.comments = parseInt(commentMatch[1]);
                    if (timeMatch) post.time = timeMatch[0];
                    
                    let link = '';
                    if (match[8]) link = match[8];
                    else if (match[7]) link = match[7];
                    else if (match[3]) link = match[3];
                    
                    if (!link) {
                        const urlMatch = line.match(/https?:\/\/\S+/);
                        if (urlMatch) link = urlMatch[0];
                    }
                    
                    post.link = extractAndValidateLink(link);
                    posts.push(post);
                }
            });
            
            if (posts.length >= 1) {
                parsedPosts = posts;
                return true;
            }
            return false;
        }
        
        function tryParseTableFormat(input) {
            const lines = input.split('\n').filter(line => line.trim() && (line.includes('|') || line.includes('\t')));
            if (lines.length < 1) return false;
            
            const posts = [];
            
            lines.forEach(line => {
                const parts = line.includes('|') ? 
                    line.split('|').map(p => p.trim()) : 
                    line.split('\t').map(p => p.trim());
                
                if (parts.length >= 3) {
                    const title = parts[0] || parts[1] || '无标题';
                    const author = parts.find(p => p.includes('[') && p.includes(']')) || 
                                   parts.find(p => p.includes('(') && p.includes(')')) || 
                                   parts[1] || '未知作者';
                    
                    const numbers = parts.filter(p => /^\d+$/.test(p)).map(Number);
                    const timePart = parts.find(p => /前$|小时|分钟|天/.test(p)) || '最近';
                    
                    let link = '';
                    const linkPart = parts.find(p => p.startsWith('http'));
                    if (linkPart) link = linkPart;
                    
                    posts.push({
                        rank: posts.length + 1,
                        title: cleanText(title),
                        author: cleanText(author.replace(/[\[\]\(\)]/g, '')),
                        views: numbers[0] || 0,
                        likes: numbers[1] || 0,
                        comments: numbers[2] || 0,
                        time: timePart,
                        link: extractAndValidateLink(link)
                    });
                }
            });
            
            if (posts.length >= 1) {
                parsedPosts = posts;
                return true;
            }
            return false;
        }
        
        function tryParseNaturalLanguage(input) {
            const lines = input.split('\n').filter(line => line.trim());
            const posts = [];
            let currentRank = 1;
            
            lines.forEach(line => {
                line = line.trim();
                
                if (line.includes('以下是') || line.includes('热帖') || line.includes('排行榜') || 
                    line.includes('---') || line.includes('===') || line.length < 10) {
                    return;
                }
                
                const titleMatch = line.match(/[^：:]+[:：]\s*(.+?)(?=\s+[\[\(]|$)/) || 
                                  line.match(/(.+?)(?=\s+[\[\(]|$)/);
                
                if (titleMatch) {
                    const title = titleMatch[1].trim();
                    
                    const authorMatch = line.match(/[\[\(](.+?)[\]\)]/);
                    const author = authorMatch ? authorMatch[1].trim() : '未知作者';
                    
                    const viewMatch = line.match(/(\d+)\s*浏览/);
                    const likeMatch = line.match(/(\d+)\s*点赞/);
                    const commentMatch = line.match(/(\d+)\s*评论/);
                    const timeMatch = line.match(/(\d+\s*(?:分钟|小时|天)前|今天|最近)/);
                    
                    let link = '';
                    const linkMatch = line.match(/https?:\/\/\S+/);
                    if (linkMatch) link = linkMatch[0];
                    
                    posts.push({
                        rank: currentRank++,
                        title: title,
                        author: author,
                        views: viewMatch ? parseInt(viewMatch[1]) : 0,
                        likes: likeMatch ? parseInt(likeMatch[1]) : 0,
                        comments: commentMatch ? parseInt(commentMatch[1]) : 0,
                        time: timeMatch ? timeMatch[0] : '最近',
                        link: extractAndValidateLink(link)
                    });
                }
            });
            
            if (posts.length >= 1) {
                parsedPosts = posts;
                return true;
            }
            return false;
        }
        
        function tryParseGeneric(input) {
            const lines = input.split('\n').filter(line => line.trim());
            const posts = [];
            
            lines.forEach((line, index) => {
                line = line.trim();
                
                if (line.includes('以下是') || line.includes('热帖') || line.includes('排行榜') || 
                    line.includes('---') || line.includes('===') || line.length < 5) {
                    return;
                }
                
                const titleMatch = line.match(/[^0-9\s\.、](.{5,50}?)(?=\s*[\[\(]|\s+\d|$)/);
                if (titleMatch) {
                    const title = titleMatch[0].trim();
                    
                    let author = '未知作者';
                    const authorMatch = line.match(/[\[\(]([^\]\)]+)[\]\)]/);
                    if (authorMatch) author = authorMatch[1].trim();
                    
                    const numbers = line.match(/\d+/g);
                    
                    let time = '最近';
                    const timeMatch = line.match(/(\d+\s*(?:分钟|小时|天)前|今天|最近)/);
                    if (timeMatch) time = timeMatch[0];
                    
                    let link = '';
                    const linkMatch = line.match(/https?:\/\/\S+/);
                    if (linkMatch) link = linkMatch[0];
                    
                    posts.push({
                        rank: index + 1,
                        title: cleanText(title),
                        author: cleanText(author),
                        views: numbers && numbers[0] ? parseInt(numbers[0]) : 0,
                        likes: numbers && numbers[1] ? parseInt(numbers[1]) : 0,
                        comments: numbers && numbers[2] ? parseInt(numbers[2]) : 0,
                        time: time,
                        link: extractAndValidateLink(link)
                    });
                }
            });
            
            if (posts.length >= 1) {
                parsedPosts = posts.slice(0, 20);
                return true;
            }
            return false;
        }
        
        function extractAndValidateLink(link) {
            if (!link) return '';
            
            link = link.trim();
            link = link.replace(/[.,;:!?]$/, '');
            
            const urlPattern = /^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w .-]*)*\/?$/;
            
            if (urlPattern.test(link)) {
                if (!link.startsWith('http')) {
                    link = 'https://' + link;
                }
                return link;
            }
            
            return '';
        }
        
        function cleanText(text) {
            return text
                .replace(/^[\.、\d\s]+/, '')
                .replace(/[\*\-_\s]+$/, '')
                .trim();
        }
        
        // ============================================
        // 【数据保存和发布】
        // ============================================
        
        function saveToPublic() {
            if (parsedPosts.length === 0) {
                showSaveMessage('没有可发布的数据', 'error');
                return;
            }
            
            const title = document.getElementById('hotlistTitle').value || '今日频道热帖排行榜';
            const note = document.getElementById('updateNote').value || '数据来源于频道AI分析';
            const limit = parseInt(document.getElementById('displayCount').value) || 10;
            
            parsedPosts.forEach(post => {
                post.hotScore = calculateHotScore(post);
            });
            
            parsedPosts.sort((a, b) => b.hotScore - a.hotScore);
            
            const displayPosts = parsedPosts.slice(0, limit).map((post, index) => ({
                ...post,
                rank: index + 1
            }));
            
            const publicData = {
                posts: displayPosts,
                meta: {
                    title: title,
                    note: note,
                    totalPosts: parsedPosts.length,
                    displayCount: displayPosts.length,
                    updateTime: new Date().toISOString(),
                    source: '频道AI分析',
                    updatedBy: 'admin'
                }
            };
            
            if (savePublicData(publicData)) {
                saveAdminData({
                    rawData: document.getElementById('aiInput').value,
                    parsedData: parsedPosts,
                    savedTime: new Date().toISOString()
                });
                
                showSaveMessage(`成功保存 ${displayPosts.length} 条热帖数据`, 'success');
                
                if (cloudConfig.configured) {
                    if (confirm('数据已保存到本地，是否同时上传到云端？')) {
                        saveToCloud();
                    }
                } else {
                    if (confirm('数据已保存到本地，是否现在配置云端同步？')) {
                        showConfigGuide();
                    }
                }
                
                if (currentMode === 'public') {
                    renderPublicHotlist();
                }
                
                document.getElementById('saveBtn').disabled = true;
            }
        }
        
        // ============================================
        // 【帖子详情功能】
        // ============================================
        
        function showPostDetail(post) {
            const overlay = document.getElementById('postDetailOverlay');
            const titleEl = document.getElementById('detailPostTitle');
            const metaEl = document.getElementById('detailPostMeta');
            const statsEl = document.getElementById('detailPostStats');
            const linkEl = document.getElementById('detailPostLink');
            
            titleEl.textContent = post.title;
            
            metaEl.innerHTML = `
                <div><i class="fas fa-user"></i> ${post.author}</div>
                <div><i class="far fa-clock"></i> ${post.time}</div>
                <div><i class="fas fa-fire"></i> 热度: ${calculateHotScore(post).toFixed(1)}</div>
            `;
            
            statsEl.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${formatNumber(post.views)}</div>
                    <div class="stat-label">浏览</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${formatNumber(post.likes)}</div>
                    <div class="stat-label">点赞</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${formatNumber(post.comments)}</div>
                    <div class="stat-label">评论</div>
                </div>
            `;
            
            if (post.link && post.link.trim() !== '') {
                linkEl.href = post.link;
                linkEl.classList.remove('link-unavailable');
                linkEl.style.display = 'inline-block';
            } else {
                linkEl.href = '#';
                linkEl.classList.add('link-unavailable');
                linkEl.style.display = 'none';
            }
            
            overlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closePostDetail() {
            const overlay = document.getElementById('postDetailOverlay');
            overlay.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // ============================================
        // 【预览和渲染】
        // ============================================
        
        function renderPreview() {
            const container = document.getElementById('previewArea');
            const count = document.getElementById('parsedCount');
            
            if (parsedPosts.length === 0) {
                container.innerHTML = `
                    <div style="text-align:center; padding:50px 20px; color:#999;">
                        <i class="fas fa-exclamation-circle fa-2x"></i>
                        <p style="margin-top:15px;">没有解析到有效数据</p>
                    </div>
                `;
                count.textContent = '0条数据';
                return;
            }
            
            let html = '';
            
            parsedPosts.forEach((post, index) => {
                const hotScore = calculateHotScore(post);
                
                let linkHtml = '';
                if (post.link && post.link.trim() !== '') {
                    linkHtml = `<a href="${post.link}" target="_blank" class="post-link" onclick="event.stopPropagation()">
                        <i class="fas fa-external-link-alt link-icon"></i> 链接
                    </a>`;
                }
                
                html += `
                    <div class="post-preview" onclick="showPostDetail(${JSON.stringify(post).replace(/"/g, '&quot;')})">
                        <div>
                            <span class="post-rank">${post.rank}</span>
                            <div class="post-title">${post.title} ${linkHtml}</div>
                        </div>
                        <div class="post-meta">
                            <span><i class="fas fa-user"></i> ${post.author}</span>
                            <span><i class="far fa-clock"></i> ${post.time}</span>
                            <span><i class="fas fa-fire"></i> 热度: ${hotScore.toFixed(1)}</span>
                        </div>
                        <div style="display:flex; gap:15px; font-size:12px; color:#666; margin-top:5px;">
                            <span><i class="far fa-eye"></i> ${formatNumber(post.views)} 浏览</span>
                            <span><i class="far fa-thumbs-up"></i> ${formatNumber(post.likes)} 点赞</span>
                            <span><i class="far fa-comment"></i> ${formatNumber(post.comments)} 评论</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            count.textContent = `${parsedPosts.length}条数据`;
        }
        
        function renderPublicHotlist() {
            const publicData = loadPublicData() || {};
            const posts = publicData.posts || [];
            const meta = publicData.meta || {};
            
            const container = document.getElementById('publicHotlist');
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div style="text-align:center; padding:80px 20px; color:#666;">
                        <i class="fas fa-inbox fa-3x"></i>
                        <h3 style="margin:20px 0 10px;">暂无热榜数据</h3>
                        <p>点击"更新数据"按钮或"管理员登录"创建热榜</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            posts.forEach((post, index) => {
                const rankClass = index === 0 ? 'rank-1' : 
                                 index === 1 ? 'rank-2' : 
                                 index === 2 ? 'rank-3' : 'rank-other';
                
                const hotScore = calculateHotScore(post);
                
                let linkHtml = '';
                if (post.link && post.link.trim() !== '') {
                    linkHtml = `<a href="${post.link}" target="_blank" class="item-link" onclick="event.stopPropagation()">
                        <i class="fas fa-external-link-alt link-icon"></i> 查看原帖
                    </a>`;
                }
                
                html += `
                    <div class="hotlist-item" onclick="showPostDetail(${JSON.stringify(post).replace(/"/g, '&quot;')})">
                        <div class="item-rank ${rankClass}">${index + 1}</div>
                        <div class="item-content">
                            <div class="item-title">
                                ${post.title}
                                ${linkHtml}
                            </div>
                            <div class="item-meta">
                                <span><i class="fas fa-user"></i> ${post.author}</span>
                                <span><i class="far fa-clock"></i> ${post.time}</span>
                                <span><i class="fas fa-fire"></i> 热度: ${hotScore.toFixed(1)}</span>
                            </div>
                            <div class="item-stats">
                                <div class="stat"><i class="far fa-eye"></i> ${formatNumber(post.views)} 浏览</div>
                                <div class="stat"><i class="far fa-thumbs-up"></i> ${formatNumber(post.likes)} 点赞</div>
                                <div class="stat"><i class="far fa-comment"></i> ${formatNumber(post.comments)} 评论</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            if (meta.title) {
                document.getElementById('publicTitle').textContent = meta.title;
            }
            if (meta.updateTime) {
                const timeStr = new Date(meta.updateTime).toLocaleString();
                document.getElementById('updateTime').textContent = `最后更新：${timeStr}`;
            }
        }
        
        // ============================================
        // 【界面控制函数】
        // ============================================
        
        function showAdminView() {
            if (checkAutoLogin()) {
                currentMode = 'admin';
                document.getElementById('adminContainer').style.display = 'block';
                document.getElementById('publicContainer').style.display = 'none';
                document.getElementById('modeSwitchBtn').innerHTML = '<i class="fas fa-eye"></i> 查看热榜';
            } else {
                showLoginOverlay();
            }
        }
        
        function showPublicView() {
            currentMode = 'public';
            document.getElementById('adminContainer').style.display = 'none';
            document.getElementById('publicContainer').style.display = 'block';
            document.getElementById('modeSwitchBtn').innerHTML = '<i class="fas fa-edit"></i> 编辑热榜';
            
            renderPublicHotlist();
        }
        
        function switchMode() {
            if (currentMode === 'admin') {
                showPublicView();
            } else {
                showAdminView();
            }
        }
        
        function enableSaveButton() {
            document.getElementById('saveBtn').disabled = false;
        }
        
        function clearInput() {
            document.getElementById('aiInput').value = '';
            parsedPosts = [];
            renderPreview();
            document.getElementById('saveBtn').disabled = true;
            showParseStatus('输入已清空', 'success');
        }
        
        // ============================================
        // 【工具函数】
        // ============================================
        
        function calculateHotScore(post) {
            return (post.views * 0.5) + (post.likes * 0.3) + (post.comments * 0.2);
        }
        
        function formatNumber(num) {
            if (num >= 10000) return (num / 10000).toFixed(1) + '万';
            if (num >= 1000) return (num / 1000).toFixed(1) + '千';
            return num.toString();
        }
        
        function showParseStatus(message, type) {
            const statusEl = document.getElementById('parseStatus');
            statusEl.textContent = message;
            statusEl.className = `parse-status parse-${type}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 3000);
        }
        
        function showSaveMessage(message, type) {
            const msgEl = document.getElementById('saveMessage');
            msgEl.textContent = message;
            msgEl.className = `message message-${type}`;
            msgEl.style.display = 'block';
            
            setTimeout(() => {
                msgEl.style.display = 'none';
            }, 3000);
        }
        
        function showMessage(message, type) {
            const msgEl = document.createElement('div');
            msgEl.innerHTML = `
                <div style="position:fixed; top:20px; right:20px; padding:15px 20px; 
                     background:${type === 'success' ? '#d4edda' : '#f8d7da'}; 
                     color:${type === 'success' ? '#155724' : '#721c24'};
                     border:1px solid ${type === 'success' ? '#c3e6cb' : '#f5c6cb'};
                     border-radius:8px; z-index:9999; max-width:400px; box-shadow:0 4px 12px rgba(0,0,0,0.15);">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'times-circle'}"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(msgEl);
            setTimeout(() => msgEl.remove(), 3000);
        }
        
        // ============================================
        // 【测试和示例数据】
        // ============================================
        
        function testWithSampleData() {
            const sampleData = `以下是今日频道热帖排行榜：

1. 今日技术分享：JavaScript新特性解析 [程序员小明] 2560浏览 320点赞 45评论 2小时前 链接：https://example.com/js-new-features
2. 前端框架对比：Vue vs React深度分析 [前端达人] 1890浏览 210点赞 32评论 3小时前 链接：https://example.com/vue-vs-react
3. 移动端适配最佳实践总结 [UI设计师] 1450浏览 180点赞 28评论 4小时前 链接：https://example.com/mobile-adaptation
4. 小程序开发经验分享 [开发小能手] 1320浏览 165点赞 25评论 5小时前 链接：https://example.com/mini-program
5. 数据库优化技巧 [后端架构师] 1250浏览 155点赞 22评论 6小时前 链接：https://example.com/database-optimization`;

            document.getElementById('aiInput').value = sampleData;
            parseAIResponse();
            showParseStatus('已加载示例数据，请点击"智能解析"', 'success');
        }
        
        // ============================================
        // 【页面初始化】
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // 加载云端配置
            loadCloudConfig();
            
            // 默认显示公共热榜
            showPublicView();
            
            // 自动尝试从云端获取数据（如果是已配置状态）
            if (cloudConfig.configured) {
                setTimeout(() => {
                    refreshData();
                }, 1000);
            }
            
            // 加载本地数据
            const localData = loadPublicData();
            if (localData && localData.posts && localData.posts.length > 0) {
                console.log('加载到本地数据:', localData.posts.length, '条');
            }
            
            // 绑定快捷键
            document.getElementById('aiInput').addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    parseAIResponse();
                }
            });
            
            // 点击详情页外部关闭
            document.getElementById('postDetailOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    closePostDetail();
                }
            });
            
            // ESC键关闭弹窗
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closePostDetail();
                    closeLoginOverlay();
                    closeConfigGuide();
                    closePasswordOverlay();
                }
            });
            
            // F5键刷新数据
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
                    e.preventDefault();
                    refreshData();
                }
            });
        });
        
        // ============================================
        // 【获取H5链接】
        // ============================================
        function getH5Link() {
            const h5Link = window.location.href;
            alert(`当前H5链接：\n${h5Link}\n\n将此链接分享给其他人，即可直接查看热榜。`);
            return h5Link;
        }
    </script>
</body>
</html>